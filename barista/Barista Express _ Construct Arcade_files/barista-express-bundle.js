var starScoresCurrentRound,currentLevel,currentRecipes,previousOrders,resultsWindow,clockComponent,mainMenuComponent,creditsComponent,scoreComponent,moneyComponent,tutorialComponent,starsComponent,fulfilledOrdersCurrentRound=0,amountOrdersCurrentRound=-1,amountCustomersCurrentRound=0,amountFailedOrdersCurrentRound=0,score=0,trayMoneyAmount=0,currentPatienceFactor=1;const levelCount=20;var recipes,levelData,unlockedLevels=1;const coffeeTime=12,milkfoamTime=8,coffeeGrindTime=5,failedOrderCost=0,debugMode=!1;var changeDaytimeComponent,originMarker,sceneLoaded=!1,nextGlassIndex=0,nextLevelsOnRight=!0;const glassPositions=["0.218 2.227 2.350","0.718 2.227 2.350","1.218 2.227 2.350","1.718 2.227 2.350"],slotMasks={default:1,glass:2,glassFull:4,filterEmpty:8,filterFull:16,milkFoamer:32,milkFoamerFoamed:64,edibles:128,movingMarker:1024};var customerSlotMask=134;const drinkLevelNames=["bottom","middle","top","crown"];var scene;"gtag"in window||(window.dataLayer=window.dataLayer||[],window.gtag=function(){dataLayer.push(arguments)}),gtag("config","UA-126910602-2"),window.addEventListener("roundEnd",function(t){gtag("event","game_round_end_"+t.detail.stars.toString()+"_stars",{event_category:"barista-express",event_label:t.detail.level,value:t.detail.score})}),window.addEventListener("startlevel",function(t){gtag("event","game_round_start",{event_category:"barista-express",value:currentLevel})}),window.addEventListener("dispense",function(t){t.detail.liquidType==LiquidType.coffeepowder?gtag("event","coffee_ground",{event_category:"barista-express",event_label:currentLevel}):t.detail.liquidType==LiquidType.milkfoam?gtag("event","milk_steamed",{event_category:"barista-express",event_label:currentLevel}):t.detail.liquidType==LiquidType.espresso&&gtag("event","espresso_made",{event_category:"barista-express",event_label:currentLevel,value:t.detail.numCups})}),window.addEventListener("delivery",function(t){gtag("event","delivery",{event_category:"barista-express",event_label:t.detail.order,value:currentLevel})}),window.addEventListener("trash",function(t){gtag("event","trash",{event_category:"barista-express",event_label:t.detail.item})}),AFRAME.registerComponent("audio-listener",{tick:function(){var t=this.el,e=new THREE.Quaternion,i=new THREE.Vector3,s=t.object3D.matrixWorld;e.setFromRotationMatrix(s),i.setFromMatrixPosition(s),Howler.pos(i.x,i.y,i.z);var n=new THREE.Vector3(0,0,-1).applyQuaternion(e),o=new THREE.Vector3(0,1,0).applyQuaternion(e);Howler.orientation(n.x,n.y,n.z,o.x,o.y,o.z)}}),AFRAME.registerComponent("bubble",{schema:{order:{type:"int",default:0}},init:function(){var t=this.el.querySelector("a-entity[text]");const e=["a","e","i","o","u"],i=["please.","thanks.","okay?"],s=["May I have a","A","Hi, a","I'd like a","Hey, make me a"];this.el.addEventListener("showBubble",function(n){var o=n.detail.customerorder;console.log(n.detail);var r="togo"==n.detail.cup?"\nto go":"",a=s[getRandomInt(s.length)],l=i[getRandomInt(i.length)],c=a+(e.includes(o.displayName[0].toLowerCase())?"n":"")+" \n"+o.displayName+r+", "+l;t.setAttribute("text",{value:c})}),this.el.addEventListener("hideBubble",this.hideBubble.bind(this))},hideBubble:function(){this.el.setAttribute("scale","0 0 0")}}),AFRAME.registerComponent("camera-logger",{schema:{timestamp:{type:"int"},seconds:{type:"int"}},log:function(){var t=this.el,e=t.getAttribute("rotation"),i=new THREE.Vector3;i.setFromMatrixPosition(t.object3D.matrixWorld),console.log("Time: "+this.data.seconds+"; Camera Position: ("+i.x.toFixed(2)+", "+i.y.toFixed(2)+", "+i.z.toFixed(2)+"); Camera Rotation: ("+e.x.toFixed(2)+", "+e.y.toFixed(2)+", "+e.z.toFixed(2)+")")},play:function(){this.data.timestamp=Date.now(),this.log()},tick:function(){Date.now()-this.data.timestamp>1e3&&(this.data.timestamp+=1e3,this.data.seconds+=1,this.log())}}),AFRAME.registerComponent("car",{schema:{startDelay:{type:"int",default:5e3}},init:function(){var t=this.el;this.el.addEventListener("animationcomplete",this.restartTimer.bind(this)),t.querySelector("a-entity").setAttribute("material",{color:getRandomColor()}),setTimeout(function(){t.emit("drive")},this.data.startDelay+Math.floor(2e3*Math.random()))},restartTimer:function(){var t=this.el,e=this.data.startDelay+Math.floor(1e4*Math.random());t.querySelector("a-entity").setAttribute("material",{color:getRandomColor()}),setTimeout(function(){t.emit("drive")},e)}}),AFRAME.registerComponent("change-daytime",{dependencies:["material"],schema:{timestep:{type:"int",default:.01},speed:{type:"float",default:.01}},init:function(){this.initialBottomColor="#eff9b7",this.initialTopColor="#24b59f",this.isRunning=!1,this.targetBottomColor="#2c3304",this.targetTopColor="#020d0c",this.tick=AFRAME.utils.throttleTick(this.tick,20,this);var t=document.querySelector("a-scene").querySelector("[clock]");t.addEventListener("startClock",this.beginDay.bind(this)),t.addEventListener("stopClock",this.endDay.bind(this)),changeDaytimeComponent||(changeDaytimeComponent=this),this.tick=AFRAME.utils.throttleTick(this.tick,1e3,this)},beginDay:function(){this.isRunning=!0,this.currentBottomColor=this.initialBottomColor,this.currentTopColor=this.initialTopColor},endDay:function(){this.isRunning=!1;var t=this;setTimeout(function(){t.isReset=!0},2e3)},reset:function(){this.isReset=!0},stop:function(){this.isReset=!1,this.isRunning=!1},tick:function(t,e){if(this.isRunning){var i=clockComponent.rotation/360;this.currentBottomColor=lerpColor(this.initialBottomColor,this.targetBottomColor,i),this.currentTopColor=lerpColor(this.initialTopColor,this.targetTopColor,i),this.el.setAttribute("material",{bottomColor:this.currentBottomColor,topColor:this.currentTopColor})}this.isReset&&(this.currentBottomColor=lerpColor(this.currentBottomColor,this.initialBottomColor,4*this.data.speed),this.currentTopColor=lerpColor(this.currentTopColor,this.initialTopColor,4*this.data.speed),this.el.setAttribute("material",{bottomColor:this.currentBottomColor,topColor:this.currentTopColor}),this.currentTopColor==this.initialTopColor&&(this.isReset=!1))}}),AFRAME.registerComponent("clock",{schema:{rotationTime:{type:"float",default:2}},init:function(){this.running=!1,this.rotation=0,this.curTime=0,this.rotationSpeed=360/this.data.rotationTime,clockComponent=this,this.tick=AFRAME.utils.throttleTick(this.tick,1e3,this)},tick:function(t,e){this.running&&(this.curTime+=e/1e3,this.rotation=this.curTime*this.rotationSpeed,this.el.setAttribute("rotation",this.rotation+" 0 0"),this.rotation>=360&&(this.el.emit("finished",{isSuccessful:!1}),this.deactivate()))},activate:function(t){this.running=!0,this.curTime=0,this.rotation=0,this.rotationSpeed=360/t,this.roundTime=t,this.el.emit("startClock")},deactivate:function(){this.running=!1,this.rotation=0,this.el.setAttribute("rotation","0 0 0"),this.el.emit("stopClock")},getRemainingTime:function(){return this.roundTime-Math.round(this.curTime)}}),AFRAME.registerSystem("collider",{schema:{debug:{type:"boolean",default:!1}},init:function(){this.data.debug&&console.log("Debug mode for collider system is enabled!")}}),AFRAME.registerComponent("collider",{schema:{type:{type:"string",default:"sphere"},scaleFactor:{type:"float",default:1}},init:function(){sceneLoaded||this.el.hasAttribute("geometry")?(this.handler=null,this.setColliderMethod()):(this.handler=this.setColliderMethod.bind(this),this.el.addEventListener("model-loaded",this.handler))},setColliderMethod:function(){if(this.mesh=this.el.getObject3D("mesh"),this.mesh){var t=this.data.type;"mesh"==t?this.mesh.raycast=THREE.Mesh.prototype.raycast:"sphere"==t?this.mesh.raycast=this.collisionSphere():"box"==t&&(this.mesh.raycast=this.collisionBox()),this.handler&&this.el.removeEventListener("model-loaded",this.handler)}else console.warn("Collider component on entity without mesh!")},collisionSphere:function(){var t=new THREE.Sphere,e=this.data.scaleFactor;if(null===this.mesh.geometry.boundingSphere&&this.mesh.geometry.computeBoundingSphere(),this.system.data.debug){t.copy(this.mesh.geometry.boundingSphere);var i=new THREE.SphereGeometry(t.radius*e,16,16),s=new THREE.EdgesGeometry(i),n=new THREE.LineBasicMaterial({color:16711680,linewidth:2}),o=new THREE.LineSegments(s,n);o.position.set(t.center.x,t.center.y,t.center.z),this.el.object3D.add(o)}return function(i,s){if(this.visible){t.copy(this.geometry.boundingSphere),t.applyMatrix4(this.matrixWorld),t.radius*=e;var n=new THREE.Vector3;if(!i.ray.intersectSphere(t,n))return!1;var o={distance:i.ray.origin.distanceTo(n),point:n.clone(),object:this};s.push(o)}}},collisionBox:function(){var t=new THREE.Box3,e=this.data.scaleFactor;if(null===this.mesh.geometry.boundingBox&&this.mesh.geometry.computeBoundingBox(),t.copy(this.mesh.geometry.boundingBox),this.system.data.debug){var i=new THREE.Vector3,s=new THREE.Vector3;t.getSize(i),t.getCenter(s);var n=new THREE.BoxGeometry(i.x*e,i.y*e,i.z*e),o=new THREE.EdgesGeometry(n),r=new THREE.LineBasicMaterial({color:16711680,linewidth:2}),a=new THREE.LineSegments(o,r);a.position.set(s.x,s.y,s.z),this.el.object3D.add(a)}return function(e,i){if(this.visible){t.copy(this.geometry.boundingBox),t.applyMatrix4(this.matrixWorld);var s=new THREE.Vector3;if(!e.ray.intersectBox(t,s))return!1;var n={distance:e.ray.origin.distanceTo(s),point:s.clone(),object:this};i.push(n)}}},setMeshCollider:function(){}}),AFRAME.registerComponent("countdown",{schema:{timestep:{type:"int",default:500},amountimgs:{type:"int",default:5}},init:function(){this.index=-1,this.running=!0,this.tick=AFRAME.utils.throttleTick(this.tick,1e3,this)},tick:function(t,e){if(this.running){if(this.index++,this.index==this.data.amountimgs)return this.el.setAttribute("visible",!1),this.index=-1,this.running=!1,this.el.setAttribute("src","#clock0"),void this.el.emit("timerfinished",this.el,!1);this.el.setAttribute("src","#clock"+this.index)}},activate:function(t,e){this.el.setAttribute("visible",!0),this.el.setAttribute("position",t),this.index=-1,this.running=!0,this.tick=AFRAME.utils.throttleTick(this.tick,e/this.data.amountimgs*1e3,this)}}),AFRAME.registerComponent("credits",{dependencies:["text"],init:function(){this.el.addEventListener("click",this.hideCredits.bind(this)),creditsComponent=this},showCredits:function(){this.el.setAttribute("visible",!0),this.el.setAttribute("class","clickable")},hideCredits:function(){this.el.setAttribute("visible",!1),this.el.setAttribute("class",""),mainMenuComponent.showOptions(!0)}}),AFRAME.registerComponent("customer",{schema:{bubbleid:{type:"string",default:""},pos:{type:"int",default:-1},character:{type:"string",default:""}},init:function(){var t=document.querySelector("a-scene").querySelector("#"+this.data.bubbleid),e=this.el,i=e.querySelector("a-entity");this.kill=!1;var s=this;this.el.addEventListener("beginLeave",this.disableSlot.bind(this)),this.el.addEventListener("animationcomplete",function(n){if("animation__leave"==n.detail.name){if(s.kill)return void e.parentNode.parentNode.removeChild(e.parentNode);s.restartCustomer()}if("animation__move"==n.detail.name){customerAnimHandler(n.detail.name,i,e),s.order=getRandomRecipe();var o=Object.keys(s.order.price),r=o[getRandomInt(o.length)];s.size=r,s.cup=coinFlip()&&s.order.takeaway?"togo":s.order.cup,t.emit("showBubble",{customerorder:s.order,cup:s.cup,size:r});var a=e.object3D.position,l=this.isFemale()?"mumble-woman":"mumble"+Math.floor(3*Math.random()).toString();playSound(l,a.x,a.y+3.9,a.z-1.256)}}.bind(this)),i.addEventListener("animationcomplete",function(t){"animation__talk"==t.detail.name&&s.beginPatience()}),this.restartCustomer()},restartCustomer:function(){var t=this.el.object3D.position,e=this.el.querySelector("a-entity");this.data.character=getUnusedCharacter(this.data.pos),e.setAttribute("gltf-part",{src:"#cafe",part:this.data.character}),playSound("steps",t.x,t.y,t.z-1.256),this.el.querySelector("a-entity").emit("beginMove"),this.el.emit("beginMove")},beginPatience:function(){var t=0==this.data.pos?"left":1==this.data.pos?"mid":"right";this.patienceBarEl=document.querySelector("a-scene").querySelector("#pat"+t),this.patienceBarEl.emit("activate",{time:this.order.patience});var e=this;this.handler=function(){e.patienceFailed()},this.patienceBarEl.addEventListener("timerfinished",this.handler),this.enableSlot()},isFemale:function(){return"character_businesswoman"===this.data.character||"character_hipstergirl"===this.data.character},patienceFailed:function(){this.el.emit("beginLeave"),document.querySelector("a-scene").querySelector("#"+this.data.bubbleid).emit("hideBubble"),this.patienceBarEl.removeEventListener("timerfinished",this.handler),amountFailedOrdersCurrentRound++,addScore(0);var t=this.el.object3D.position,e=this.isFemale()?"grumble-woman":"grumble"+Math.floor(3*Math.random()).toString();playSound(e,t.x,t.y+3.9,t.z-1.256)},stopPatience:function(){var t=0==this.data.pos?"left":1==this.data.pos?"mid":"right";this.patienceBarEl=document.querySelector("a-scene").querySelector("#pat"+t),this.patienceBarEl.emit("deactivate"),this.patienceBarEl.removeEventListener("timerfinished",this.handler)},enableSlot:function(){this.el.parentNode.querySelector("[customer-delivery]").emit("setEnabled",{b:!0})},disableSlot:function(){var t=this.el.parentNode.querySelector("[customer-delivery]");t.setAttribute("class",""),t.setAttribute("visible",!1),t.emit("setEnabled",{b:!1})}}),AFRAME.registerComponent("customer-delivery",{dependencies:["slot"],schema:{customerid:{type:"string",default:""}},init:function(){this.el.addEventListener("filled",this.onObjectPlaced.bind(this)),this.el.emit("setEnabled",{b:!1})},onObjectPlaced:function(t){var e=document.getElementById(this.data.customerid).components.customer,i=document.getElementById(e.data.bubbleid),s=0,n=e.order,o=t.detail.content.el.components["drink-container"],r=t.detail.content.el.components.edible;if(o){var a=e.cup;o.size,e.size;recipes.beverages[n.id]&&(s=rateOrderContent(n.ingredients,o.liquids))>0&&checkCorrectGlass(o.data.type,a)&&s++}else r&&(s=r.data.type==n.id?3:0);window.dispatchEvent(new CustomEvent("delivery",{detail:{order:n.id,correct:s>0}})),console.log(`Order score: ${s}`);var l=.05*s,c=(n.price.S||n.price)*l;if(s>0){o&&o.emptyCup(),this.el.components.slot.clear();var u=e.el.object3D.position;e.stopPatience();var d=u.x+" 1.01822 "+(u.z-.475144);moneyComponent.beginAnimation(d),trayMoneyAmount=(n.price.S||n.price)+c,o?o.el.parentNode.removeChild(o.el):r.el.parentNode.removeChild(r.el),i.setAttribute("scale","0 0 0"),fulfilledOrdersCurrentRound++,e.el&&setTimeout(function(){e.el.emit("beginLeave")},1e3)}}}),AFRAME.registerComponent("dispenser",{schema:{liquidtype:{type:"int",default:0},streamid:{type:"string",default:""},secondSlot:{type:"string",default:""},firstSlot:{type:"string",default:""},hasClickableChild:{type:"bool",default:!1}},init:function(){this.el.addEventListener("filled",this.onObjectPlaced.bind(this)),this.el.addEventListener("cleared",this.onObjectRemoved.bind(this)),document.querySelector("a-scene").addEventListener("roundEnd",this.roundEnd.bind(this)),this.running=!1,this.secondSlotSet=!1,this.data.hasClickableChild&&this.el.addEventListener("setClickable",this.setClickable.bind(this))},setClickable:function(t){this.el.querySelector("a-box").setAttribute("class",t.detail.state?"clickable":"")},onObjectRemoved:function(t){""!==this.data.firstSlot&&this.secondSlotSet&&(document.getElementById(this.data.firstSlot).object3D.position.z+=.04,this.secondSlotSet=!1);""!==this.data.secondSlot&&document.getElementById(this.data.secondSlot).setAttribute("slot","mask",1e3)},onObjectPlaced:function(t){if(this.el.components.slot.content){if(""!==this.data.firstSlot&&!this.secondSlotSet)document.getElementById(this.data.firstSlot).object3D.position.z-=.04,this.secondSlotSet=!0;if(""!==this.data.secondSlot)document.getElementById(this.data.secondSlot).setAttribute("slot","mask",this.el.components.slot.data.mask);var e=this.el.components["dispenser-condition"];if(!e||e.isConditionMet()){var i=this.el.object3D.position.clone().add(new THREE.Vector3(-.045,.15,0)),s=[this.el.components.slot];if(""!==this.data.secondSlot&&s.push(document.getElementById(this.data.secondSlot).components.slot),s.forEach(t=>{if(t&&t.content){t.content.el.setAttribute("class","");for(var e=t.content.el.querySelectorAll(".clickable"),i=0;i<e.length;i++)e[i].setAttribute("class","")}}),this.progBar=getAvailableProgressBar(),this.progBar.setTimerFinishedListener(this.timerFinished.bind(this)),""!=this.data.streamid&&document.querySelector("a-scene").querySelector("#"+this.data.streamid).setAttribute("visible",!0),this.data.liquidtype==LiquidType.espresso){var n=(s[0].content?1:0)+(s[1].content?1:0);window.dispatchEvent(new CustomEvent("dispense",{detail:{liquidType:this.data.liquidtype,numCups:n}})),this.progBar.activate(i,12);var o=this.el.object3D.position;this.lastSoundId=playSound("espresso",o.x,o.y,o.z)}else if(this.data.liquidtype==LiquidType.milkfoam){window.dispatchEvent(new CustomEvent("dispense",{detail:{liquidType:this.data.liquidtype}})),this.progBar.activate(i,8);o=this.el.object3D.position;this.lastSoundId=playSound("milk-steamer",o.x,o.y,o.z)}else if(this.data.liquidtype==LiquidType.coffeepowder){window.dispatchEvent(new CustomEvent("dispense",{detail:{liquidType:this.data.liquidtype}})),this.progBar.activate(i,5);o=this.el.object3D.position;this.lastSoundId=playSound("grinder",o.x,o.y,o.z)}getInventory().heldObject&&console.log(getInventory().heldObject)}}},timerFinished:function(t){this.progBar.deactivate(),this.progBar=null,""!=this.data.streamid&&document.getElementById(this.data.streamid).setAttribute("visible",!1);var e=[this.el.components.slot];""!==this.data.secondSlot&&e.push(document.getElementById(this.data.secondSlot).components.slot),e.forEach(t=>{if(t&&t.content){t.content.el.setAttribute("class","clickable"),t.content.el.emit("fill",{liquidtype:this.data.liquidtype});var e=this.el.components["dispenser-condition"];e&&e.unlock&&e.unlock()}})},roundEnd:function(){this.progBar&&(this.progBar.deactivate(),this.progBar=null),""!=this.data.streamid&&document.getElementById(this.data.streamid).setAttribute("visible",!1);var t=[this.el.components.slot];""!==this.data.secondSlot&&t.push(document.getElementById(this.data.secondSlot).components.slot),t.forEach(t=>{if(t&&t.content){t.clear();var e=this.el.components["dispenser-condition"];e&&e.unlock&&e.unlock()}}),stopSound(this.lastSoundId)}}),AFRAME.registerComponent("dispenser-condition",{schema:{conditionid:{type:"string",default:""},component:{type:"string",default:""}},init:function(){"filter-placer"==this.data.component&&(this.condEl=document.getElementById(this.data.conditionid))},unlock:function(){var t=this.condEl.components[this.data.component];t&&t.unlock&&t.unlock()},isConditionMet:function(){var t=this.condEl.components[this.data.component];if(t&&t.canBeUsed)return t.canBeUsed()}}),AFRAME.registerComponent("drink-container",{schema:{type:{type:"string",default:"glass"}},init:function(){this.fillAmount=0,this.liquids=[],this.size="S";this.el;this.el.addEventListener("use",this.use.bind(this)),this.el.addEventListener("use-on",this.useOn.bind(this)),this.el.addEventListener("fill",this.fillCoffee.bind(this)),this.el.addEventListener("placed",this.placeContainer.bind(this)),this.el.addEventListener("used-by",this.fillInto.bind(this))},fillInto:function(t){var e=t.detail.user.el.components.milkfoamer;e&&e.isFoamed()&&(this.el.emit("fill",{liquidtype:LiquidType.milkfoam}),e.use())},fillCoffee:function(t){if(4!=this.fillAmount){var e=this.el.querySelector("."+drinkLevelNames[this.fillAmount]);this.liquids.push(t.detail.liquidtype),setLiquidColor(e,t.detail.liquidtype),e.setAttribute("visible",!0),this.fillAmount++,4==this.fillAmount&&this.el.setAttribute("pickable",{slotmask:slotMasks.glassFull})}},emptyCup:function(){this.fillAmount=0,this.liquids=[];for(var t=0;t<4;t++)this.el.querySelector("."+drinkLevelNames[t]).setAttribute("visible",!1);this.el.setAttribute("pickable",{slotmask:slotMasks.glass})},use:function(t){console.log("my-useable was used!")},useOn:function(t){console.log("my-useable was used on "+t.detail.receiver)},placeContainer:function(t){var e=this.el.object3D.position;"cap"==this.data.type||"espresso"==this.data.type||"togo"==this.data.type?playSound("cup",e.x,e.y,e.z):playSound(this.data.type,e.x,e.y,e.z)},scaleToNextSize:function(){switch(this.size){case"S":this.size="M",this.el.setAttribute("scale","1.0 1.0 1.0");break;case"M":this.size="L",this.el.setAttribute("scale","1.2 1.2 1.2");break;case"L":this.size="S",this.el.setAttribute("scale","0.8 0.8 0.8")}}}),AFRAME.registerComponent("edible",{schema:{type:{type:"string",default:"cupcake"}}}),AFRAME.registerComponent("edible-dispenser",{schema:{edible:{type:"string",default:""},type:{type:"string",default:""}},init:function(){this.el.addEventListener("click",this.use.bind(this))},use:function(t){if(!getInventory().heldObject){var e=getEdibleEntity(this.data.edible,this.data.type);e.setAttribute("position",this.el.getAttribute("position")),document.querySelector("a-scene").appendChild(e),e.components.pickable.click(e.components.pickable)}}}),AFRAME.registerComponent("empty-use-dispenser",{init:function(){this.el.addEventListener("used-by",this.use.bind(this))},use:function(t){var e=this.el.object3D.position,i={x:e.x+.6616,y:e.y+.542,z:e.z+1.2},s=t.detail.user.el;if(s.components.filter){var n=s.components.filter;"empty"!=n.state&&(n.empty(),playSound("trash",i.x,i.y,i.z),window.dispatchEvent(new CustomEvent("trash",{detail:{item:"used"==n.state?"coffeepuk":"coffeepowder",full:!0}})))}else s.components["drink-container"]?(window.dispatchEvent(new CustomEvent("trash",{detail:{item:s.components["drink-container"].data.type,full:0!=s.components["drink-container"].liquids.length}})),getInventory().heldObject=null,s.components["drink-container"].emptyCup(),s.parentNode.removeChild(s),playSound("trash",i.x,i.y,i.z)):s.components.edible&&(window.dispatchEvent(new CustomEvent("trash",{detail:{item:s.components.edible.data.type,full:!1}})),getInventory().heldObject=null,s.parentNode.removeChild(s),playSound("trash",i.x,i.y,i.z))}});var LiquidType={espresso:0,milkfoam:1,sirupchocolate:2,sirupchocolatewhite:3,sirupcaramel:4,coffeepowder:5};AFRAME.registerComponent("filter",{init:function(){this.state="empty";this.el;this.el.addEventListener("fill",this.fill.bind(this)),this.el.addEventListener("placed",this.placed.bind(this)),this.el.addEventListener("reset",this.empty.bind(this)),this.el.addEventListener("setClickable",function(t){t.detail.state?this.unlock():this.lock()}.bind(this))},isFilled:function(){return"filled"==this.state},placed:function(t){var e=t.detail.slot.el.components["filter-placer"];e&&e.use()},fill:function(t){"empty"==this.state&&(this.el.setAttribute("pickable",{slotmask:slotMasks.filterFull}),this.state="filled",this.el.querySelector("#coffee").setAttribute("material",{color:"#583223"}),this.el.querySelector("#coffee").setAttribute("visible",!0))},empty:function(t){"empty"!=this.state&&(this.el.setAttribute("pickable",{slotmask:slotMasks.filterEmpty}),this.state="empty",this.el.querySelector("#coffee").setAttribute("visible",!1))},use:function(t){"filled"==this.state&&(this.el.querySelector("#coffee").setAttribute("material",{color:"black"}),this.state="used")},lock:function(){this.el.setAttribute("class","")},unlock:function(){this.el.setAttribute("class","clickable")}}),AFRAME.registerComponent("filter-placer",{schema:{callBackTo:{default:[],parse:function(t){return t.split(",").map(t=>document.getElementById(t.trim()))},stringify:function(t){return t.map(t=>t.id).join(",")}}},init:function(){this.el.addEventListener("setClickable",this.setClickable.bind(this))},setClickable:function(t){this.el.querySelector("a-box").setAttribute("class",t.detail.state?"clickable":"")},use:function(){var t=this.el.components.slot.content;t&&this.data.callBackTo&&this.data.callBackTo.forEach(e=>{e.emit("filled",{content:t})})},unlock:function(t){var e=this.el.components.slot.content.el.components.filter;e&&e.unlock()},canBeUsed:function(){if(!this.el.components.slot.content)return!1;var t=this.el.components.slot.content.el.components.filter;return!!t.isFilled()&&(t.use(),t.lock(),!0)}}),deactivateSign=function(t){scene.querySelector("#signel").querySelector("#"+t+"sign").setAttribute("visible",!1)},activateSigns=function(){for(var t=scene.querySelector("#signel").querySelectorAll("a-plane"),e=0;e<t.length;e++)t[e].setAttribute("visible",!0)};var activeClickables=[];startLevelTutorialCheck=function(t){currentLevel=t,"tutorialImage"in levelData.levels[t-1]?tutorialComponent.showTutorial(levelData.levels[t-1].tutorialImage):startLevel(t)},startLevel=function(t){window.dispatchEvent(new CustomEvent("startlevel"),{detail:{level:t}});var e=levelData.levels[t-1];for(r in currentRecipes=e.orders,normalizeWeights(currentRecipes),currentPatienceFactor=e.patienceFactor||1,previousOrders=[],starScoresCurrentRound=e.starScores,amountFailedOrdersCurrentRound=0,trayMoneyAmount=0,score=0,setClickableActive("leftfilter",!0),setClickableActive("rightfilter",!0),currentRecipes)recipes.beverages[r]&&(console.log(r),deactivateSign(recipes.beverages[r].id),setClickableActive(recipes.beverages[r].dispenserId,!0),"cappuccino"==r&&(setClickableActive("milkfoamer",!0),setClickableActive("milkcarton",!0)));3<=t&&(setClickableActive("togodispenserleft",!0),setClickableActive("togodispenserright",!0)),amountCustomersCurrentRound=e.amountCustomers,fulfilledOrdersCurrentRound=0,amountOrdersCurrentRound=e.amountOrders,spawnCustomer("mid"),e.amountCustomers>2&&spawnCustomer("right"),e.amountCustomers>1&&spawnCustomer("left");var i=scene.querySelector("a-entity[clock]");i&&(i.components.clock.activate(e.amountTime),i.addEventListener("finished",endLevel)),document.getElementById("leaderboard").setAttribute("visible",!1)},endLevel=function(t){despawnCustomer("mid"),despawnCustomer("left"),despawnCustomer("right");var e=scene.querySelector("a-entity[clock]");e.removeEventListener("finished",endLevel),e.components.clock.deactivate();for(var i=scene.querySelectorAll("[patience-bar]"),s=0;s<i.length;s++)i[s].emit("deactivate");try{var n=document.getElementById("leaderboard");n.setAttribute("visible",!0),n.components.leaderboard.submitScore(score)}catch(t){}var o=1==t||0==t?t:t.detail.isSuccessful;starScoresCurrentRound&&(o=starScoresCurrentRound[0]<=score+.01),activateSigns(),resetFilters();for(s=0;s<activeClickables.length;s++)setClickableActive(activeClickables[s],!1);activeClickables=[],resultsWindow.showResults(o),moneyComponent.onClick(!0),scoreComponent.resetScore(),o&&unlockedLevels==currentLevel&&(unlockedLevels++,setUnlockedLevelsState());var r=scene.querySelectorAll("[drink-container]"),a=scene.querySelectorAll("[edibles]");for(s=0;s<r.length;s++){r[s];r[s].components.pickable.slot.clear(),r[s].parentNode.removeChild(r[s])}for(s=0;s<a.length;s++)a[s].parentNode.removeChild(a[s]);scene.emit("roundEnd")},despawnCustomer=function(t){var e=scene.querySelector("#"+t+"customer");e&&scene.removeChild(e.parentNode)},resetFilters=function(){getInventory().clear();var t=scene.querySelector("#leftfilter"),e=scene.querySelector("#rightfilter");t.emit("reset"),e.emit("reset")},spawnCustomer=function(t){var e,i;switch(t){case"mid":e=["-3.3 0 -2.7168","0 0 0","0.111 0.874 0.146",2200,"0.1667 1.6278 -0.3811"],i=1;break;case"left":e=["-3.500 0 -3.016","-0.752 0 -0.040","-0.3216 0.8748 0.1924",3300,"-0.5907 1.6278 -0.4451"],i=0;break;case"right":i=2,e=["-4 0 -3.5168","0.752 0 -0.06","0.5248 0.8748 0.2084",4400,"0.9187 1.6278 -0.4611"]}if(e){var s=e[0],n=e[1],o=e[2],r=e[3],a=e[4],l=document.createElement("a-entity"),c=document.createElement("a-entity");c.setAttribute("id",t+"customer"),c.setAttribute("animation__leave",{property:"position",from:n,to:s,dur:r,startEvents:"beginLeave",easing:"easeOutQuad"}),c.setAttribute("animation__move",{property:"position",from:s,to:n,dur:r,startEvents:"beginMove",easing:"easeOutQuad"});var u=getUnusedCharacter();c.setAttribute("customer",{bubbleid:"bubble"+t,pos:i,character:u});var d=document.createElement("a-entity");console.log("Character is now "+u),d.setAttribute("gltf-part",{src:"#cafe",part:u}),d.setAttribute("animation__vert",{property:"object3D.position.y",from:0,to:.06,dir:"alternate",dur:250,autoplay:!0,loop:!0,pauseEvents:"beginTalk",startEvents:"beginMove"}),d.setAttribute("animation__hori",{property:"object3D.position.x",from:-.04,to:.04,easing:"linear",dur:500,dir:"alternate",autoplay:!0,loop:!0,pauseEvents:"beginTalk",startEvents:"beginMove"}),d.setAttribute("animation__talk",{property:"object3D.position.y",from:0,to:.022,dir:"alternate",dur:140,loop:!0,startEvents:"beginTalk",loop:12}),c.appendChild(d),l.appendChild(c);var h=document.createElement("a-entity");h.setAttribute("bubble",""),h.setAttribute("id","bubble"+t),h.setAttribute("gltf-part",{src:"#cafe",part:"bubble"}),h.setAttribute("position",a),h.setAttribute("scale","0 0 0"),h.setAttribute("animation__spawn",{property:"scale",from:"0 0 0",to:"1 1 1",dur:2e3,easing:"easeOutElastic",autoplay:!1,startEvents:"showBubble"});var m=document.createElement("a-entity");m.setAttribute("text",{shader:"msdf",font:"https://raw.githubusercontent.com/etiennepinchon/aframe-fonts/master/fonts/handlee/Handlee-Regular.json",color:"black",align:"center",baseline:"top",value:"Placeholder"}),m.setAttribute("position","-0.12 0.4 0.0520"),m.setAttribute("scale","1.6 1.6 1.6"),h.appendChild(m);var p=document.createElement("a-entity");p.setAttribute("gltf-part",{src:"#cafe",part:"bubble_outline"}),h.appendChild(p),l.appendChild(h);var b=document.createElement("a-entity");b.setAttribute("class",""),b.setAttribute("customer-delivery",{customerid:t+"customer"}),b.setAttribute("slot",{mask:customerSlotMask}),b.setAttribute("scale-on-hover",""),b.setAttribute("gltf-part",{src:"#cafe",part:"marker"}),b.setAttribute("position",o),b.setAttribute("rotation","0 0 0"),b.setAttribute("collider",{type:"sphere",static:!0}),l.appendChild(b),scene.appendChild(l)}};const characterModels=["character_hipsterguy","character_hipstergirl","character_fitnessguy","character_businesswoman"];var usedCharacterIndices=[];getUnusedCharacter=function(t){usedCharacterIndices[t]=-1;for(var e=Math.floor(Math.random()*characterModels.length);usedCharacterIndices.includes(e);)e=Math.floor(Math.random()*characterModels.length);return usedCharacterIndices[t]=e,characterModels[e]},playSound=function(t,e,i,s){var n=sound.play(t);return sound.pos(e,i,s,n),n},stopSound=function(t){sound.stop(t)},spawnMainMenu=function(t,e,i){var s=document.createElement("a-entity");s.setAttribute("id","mainmenu");var n=document.createElement("a-entity");n.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),n.setAttribute("text",{value:"Play",color:"white",align:"center",width:4}),n.setAttribute("class","clickable"),n.setAttribute("collider",{type:"box",static:!0}),n.setAttribute("menu-button",""),n.setAttribute("position",t+" "+e+" "+-.35),s.appendChild(n);var o=document.createElement("a-entity");o.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),o.setAttribute("text",{value:"Options",color:"white",align:"center",width:4}),o.setAttribute("collider",{type:"box",static:!0}),o.setAttribute("class","clickable"),o.setAttribute("menu-button",""),o.setAttribute("position",t+" "+(e+i)+" "+-.35),s.appendChild(o);var r=document.createElement("a-entity"),a=document.createElement("a-entity");a.setAttribute("gltf-part",{src:"#ca-logo",part:"logo"}),a.setAttribute("scale","0.3 0.3 0.3"),a.setAttribute("material",{shader:"flat",color:"white"}),r.appendChild(a);var l=document.createElement("a-image");return l.setAttribute("src","#more-games"),l.setAttribute("position","0.37 0.15 0.1"),l.setAttribute("rotation","0 0 -30"),l.setAttribute("animation","property: scale; from: 0.3 0.3 0.3; to: 0.4 0.4 0.4; dur: 600; loop: true; dir: alternate"),r.appendChild(l),r.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),r.setAttribute("class","clickable"),r.setAttribute("collider",{type:"box",static:!0}),r.setAttribute("menu-button",""),r.setAttribute("position",t+" "+(e+2*i)+" "+-.35),s.appendChild(r),scene.appendChild(s),s};var muted=!1,currentVolume=1;spawnOptionsMenu=function(t,e,i){var s=document.createElement("a-entity");s.setAttribute("id","optionsmenu");for(var n=[],o=t+.9+.1,r=0;r<5;r++){var a=document.createElement("a-box");a.setAttribute("position",o+.1*r+" "+e+" "+-.35),a.setAttribute("color","yellow"),a.setAttribute("scale","0.05 "+(.1+.0095*r)+" 0.01"),n.push(a),s.appendChild(a)}var l=document.createElement("a-entity");l.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),l.setAttribute("text",{value:"Mute",color:"white",align:"center",width:4}),l.setAttribute("class","clickable"),l.setAttribute("collider",{type:"box",static:!0}),l.setAttribute("menu-button",""),l.setAttribute("position",t+" "+e+" "+-.35),l.addEventListener("click",function(){muted=!muted,Howler.mute(muted),l.setAttribute("text",{color:muted?"red":"white"})}),s.appendChild(l);var c=document.createElement("a-entity");c.setAttribute("gltf-part",{src:"#cafe",part:"levelbutton"}),c.setAttribute("text",{value:"-",color:"white",align:"center",width:4,zOffset:.01}),c.setAttribute("class","clickable"),c.setAttribute("menu-button",""),c.setAttribute("collider",{type:"sphere"}),c.setAttribute("position",t+.79+" "+e+" "+-.35),c.addEventListener("click",function(){var t=Math.round(5*currentVolume)-1;t<0&&(t=0),n[t].setAttribute("visible",!1),changeVolume(-.2),muted&&(muted=!1,Howler.mute(!1),l.setAttribute("text",{color:"white"}))}),s.appendChild(c);var u=document.createElement("a-entity");u.setAttribute("gltf-part",{src:"#cafe",part:"levelbutton"}),u.setAttribute("text",{value:"+",color:"white",align:"center",width:4,zOffset:.01}),u.setAttribute("class","clickable"),u.setAttribute("menu-button",""),u.setAttribute("collider",{type:"sphere",static:!0}),u.setAttribute("position",t+1.61+" "+e+" "+-.35),u.addEventListener("click",function(){changeVolume(.2);var t=Math.round(5*currentVolume)-1;n[t].setAttribute("visible",!0),muted&&(muted=!1,Howler.mute(!1),l.setAttribute("text",{color:"white"}))}),s.appendChild(u);var d=document.createElement("a-entity");d.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),d.setAttribute("text",{value:"Credits",color:"white",align:"center",width:4}),d.setAttribute("class","clickable"),d.setAttribute("collider",{type:"box",static:!0}),d.setAttribute("menu-button",""),d.setAttribute("position",t+" "+(e+i)+" "+-.35),s.appendChild(d);var h=document.createElement("a-entity");h.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),h.setAttribute("text",{value:"Reset\nprogress",color:"white",align:"center",width:3}),h.setAttribute("class","clickable"),h.setAttribute("collider",{type:"box",static:!0}),h.setAttribute("menu-button",""),h.setAttribute("position",t+1.2+" "+(e+i)+" "+-.35),s.appendChild(h);var m=document.createElement("a-entity");return m.setAttribute("position","0 "+(e+2*i)+" "+-.35),m.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),m.setAttribute("class","clickable"),m.setAttribute("collider",{type:"box",static:!0}),m.setAttribute("text",{value:"Back",color:"white",align:"center",width:4}),m.setAttribute("menu-button",""),s.appendChild(m),scene.appendChild(s),s},getEdibleEntity=function(t,e){var i=document.createElement("a-entity");i.setAttribute("class","clickable"),i.setAttribute("pickable",{slotmask:slotMasks.edibles}),i.setAttribute("placeable",""),i.setAttribute("edible",{type:t}),i.setAttribute("usable",""),i.setAttribute("gltf-part",{src:"#cafe",part:t+"_"+e});var s=!1;("muffin"==t||"cupcake"==t&&"red"==e)&&(s=!0);var n=document.createElement("a-entity");if(n.setAttribute("gltf-part",{src:"#cafe",part:t+"_"+e+"_top"}),n.setAttribute("class","clickable"),i.appendChild(n),s){var o=document.createElement("a-entity");o.setAttribute("gltf-part",{src:"#cafe",part:t+"_"+e+"_crown"}),o.setAttribute("class","clickable"),i.appendChild(o)}return i},changeVolume=function(t){(currentVolume+=t)<0&&(currentVolume=0),currentVolume>1&&(currentVolume=1),Howler.volume(currentVolume)},spawnLevelSelectionMenu=function(t,e,i,s){var n=document.createElement("a-entity");n.setAttribute("id","levelselectmenu");for(var o=0;o<2;o++)for(var r=0;r<5;r++){var a=5*o+r+1;if(!(a>20)){var l=document.createElement("a-entity");l.setAttribute("gltf-part",{src:"#cafe",part:"levelbutton"}),l.setAttribute("text",{value:a,color:"white",align:"center",width:3.5,zOffset:.01}),a>unlockedLevels?l.setAttribute("material",{opacity:.5,transparent:!0}):l.setAttribute("scale-on-hover",""),l.setAttribute("position",t+r*i+" "+(e+o*s)+" "+-.35),l.setAttribute("class","clickable"),l.setAttribute("collider",{type:"sphere",static:!0}),l.setAttribute("level-select-button",""),n.appendChild(l)}}var c=document.createElement("a-entity");c.setAttribute("position",t+5*i+" "+(e+.5*s)+" "+-.35),c.setAttribute("gltf-part",{src:"#cafe",part:"levelbutton"}),c.setAttribute("scale-on-hover",{sound:"uihover"}),c.setAttribute("class","clickable"),c.setAttribute("next-levels-button",{levelParentId:"levelselectmenu"}),c.setAttribute("id","nextlevels"),c.setAttribute("collider",{type:"sphere",static:!0}),c.setAttribute("text",{value:">",color:"white",align:"center",width:3.5,zOffset:.01}),n.appendChild(c);var u=document.createElement("a-entity");return u.setAttribute("position",t+2*i+" "+(e+2.5*s+.16)+" "+-.35),u.setAttribute("gltf-part",{src:"#cafe",part:"menubutton"}),u.setAttribute("class","clickable"),u.setAttribute("collider",{type:"box",static:!0}),u.setAttribute("id","back"),u.setAttribute("text",{value:"Back",color:"white",align:"center",width:4}),u.setAttribute("menu-button",""),n.appendChild(u),scene.appendChild(n),n},getCupEntity=function(t){var e,i=document.createElement("a-entity");i.setAttribute("class","clickable"),i.setAttribute("collider",{type:"box",static:!0}),i.setAttribute("usable",""),i.setAttribute("pickable",{slotmask:slotMasks.glass}),i.setAttribute("placeable",""),i.setAttribute("use-receiver",""),i.setAttribute("drink-container",{type:t}),i.setAttribute("scale-on-hover",""),e="espresso"==t?"cap":t,i.setAttribute("gltf-part",{src:"#cafe",part:"cup_"+e});var s=document.createElement("a-entity");s.setAttribute("visible","false"),s.setAttribute("class","crown"),s.setAttribute("gltf-part",{src:"#cafe",part:"cup_"+e+"_crown"}),i.appendChild(s);var n=document.createElement("a-entity");n.setAttribute("visible","false"),n.setAttribute("class","top"),n.setAttribute("gltf-part",{src:"#cafe",part:"cup_"+e+"_top"}),i.appendChild(n);var o=document.createElement("a-entity");o.setAttribute("visible","false"),o.setAttribute("class","middle"),o.setAttribute("gltf-part",{src:"#cafe",part:"cup_"+e+"_middle"}),i.appendChild(o);var r=document.createElement("a-entity");switch(r.setAttribute("visible","false"),r.setAttribute("class","bottom"),r.setAttribute("gltf-part",{src:"#cafe",part:"cup_"+e+"_bottom"}),i.appendChild(r),t){case"glass":break;case"cap":(a=document.createElement("a-entity")).setAttribute("gltf-part",{src:"#cafe",part:"cup_cap_plate"}),i.appendChild(a);break;case"espresso":var a;i.setAttribute("scale","0.52 0.52 0.52"),(a=document.createElement("a-entity")).setAttribute("gltf-part",{src:"#cafe",part:"cup_cap_plate"}),i.appendChild(a);break;case"togo":var l=document.createElement("a-entity");l.setAttribute("gltf-part",{src:"#cafe",part:"cup_togo_sleeve"}),i.appendChild(l)}return i},setUnlockedLevelsState=function(){var t=scene.querySelector("#levelselectmenu").querySelectorAll("a-entity");cookie_create("unlockedLevel",unlockedLevels);for(var e=nextLevelsOnRight?1:11,i=0;i<t.length;i++)if(i+e>unlockedLevels){if("back"==t[i].getAttribute("id")||"nextlevels"==t[i].getAttribute("id"))continue;t[i].setAttribute("material",{opacity:.5,transparent:!0,color:"white"}),t[i].removeAttribute("class")}else t[i].setAttribute("material",{opacity:1,transparent:!1,color:"black"}),t[i].setAttribute("scale-on-hover",""),t[i].setAttribute("class","clickable")},setLiquidColor=function(t,e){switch(e){case LiquidType.espresso:t.setAttribute("material",{color:"#82470d"});break;case LiquidType.milkfoam:t.setAttribute("material",{color:"#ffffff"});break;case LiquidType.sirupchocolate:t.setAttribute("material",{color:"#4c2907"});break;case LiquidType.sirupchocolatewhite:t.setAttribute("material",{color:"#e1e2d5"});break;case LiquidType.sirupcaramel:t.setAttribute("material",{color:"#c78752"})}},customerAnimHandler=function(t,e,i){"animation__move"==t?e.emit("beginTalk"):"animation__talk"==t&&(console.log("talk end"),i.components.customer.beginTimer())},readLevelsFile=function(){fetch("data/levels.json").then(t=>t.json()).then(t=>{levelData=t}).catch(t=>{console.log(t)})},readRecipesFile=function(){fetch("data/recipes.json").then(t=>t.json()).then(t=>{recipes=t}).catch(t=>{console.error(t)})},getRandomRecipe=function(){if(recipes){var t=currentRecipes.length,e=(Math.floor(Math.random()*t),selfWeightedRandom(currentRecipes));return e||console.error("Order was undefined"),recipes.beverages[e]||recipes.foods[e]}console.error("No recipes loaded!")},rateOrderContent=function(t,e){console.log("Want: "+t+",  Got: "+e);var i=!0;if(e.length!=t.length)i=!1;else for(var s=0;s<t.length;s++)e[s]!=t[s]&&(i=!1);var n=0;return!(e.length<t.length)&&isSubset(e,t)&&n++,i&&n++,e.length>t.length&&(n=0),n},getAvailableTimer=function(){return scene.querySelector("#countdown1").components.countdown};var allProgressBars=void 0;function coinFlip(){return 0==Math.floor(2*Math.random())}function isSubset(t,e){for(var i=0;i<e.length;i++)if(-1==t.indexOf(e[i]))return!1;return!0}function roundDecimals(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)}function lerpColor(t,e,i){var s=+t.replace("#","0x"),n=s>>16,o=s>>8&255,r=255&s,a=+e.replace("#","0x");return"#"+((1<<24)+(n+i*((a>>16)-n)<<16)+(o+i*((a>>8&255)-o)<<8)+(r+i*((255&a)-r))|0).toString(16).slice(1)}function getRandomInt(t){return Math.floor(Math.random()*Math.floor(t))}function getRandomColor(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function SetScale(t,e){scene.querySelector("#"+t).setAttribute("scale",e+" "+e+" "+e)}function helper(t){console.log(AFRAME.utils.coordinates.stringify(scene.querySelector("#"+t).object3D.position.multiplyScalar(.4)))}function f(t){var e=AFRAME.utils.coordinates.parse(t),i=new THREE.Vector3(e.x,e.y,e.z);console.log(AFRAME.utils.coordinates.stringify(i.multiplyScalar(.4)))}getAvailableProgressBar=function(){allProgressBars||(allProgressBars=[document.getElementById("prog0").components["progress-bar"],document.getElementById("prog1").components["progress-bar"],document.getElementById("prog2").components["progress-bar"]]);for(var t=0;t<3;++t)if(allProgressBars[t].useIfUnused())return allProgressBars[t];return comp},checkCorrectGlass=function(t,e){return t==e},addScore=function(t){scoreComponent||(scoreComponent=scene.querySelector("#scoredisplay").components.score),scoreComponent.increaseScore(t)},getResultText=function(t){return"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nToday's earnings\n"+("$"+roundDecimals(score,1).toFixed(2))+"\n\nScore needed\n"+("$"+roundDecimals(starScoresCurrentRound[0],1).toFixed(2))+"\n\nCustomers satisfied\n"+fulfilledOrdersCurrentRound+"/"+(fulfilledOrdersCurrentRound+amountFailedOrdersCurrentRound)+"\n\nCustomers disappointed\n"+amountFailedOrdersCurrentRound+"\n\n\nclick to continue"},setClickableActive=function(t,e){if(t){var i=scene.querySelector("#"+t);i&&(e?(i.setAttribute("class","clickable"),i.setAttribute("visible",!0),activeClickables.push(t)):(i.setAttribute("class",""),i.setAttribute("visible",!1)))}},cookie_create=function(t,e,i){var s;i&&((s=new Date).setTime(s.getTime()+24*i*60*60*1e3),s.toGMTString()),document.cookie=t+"="+e+";",s=null},cookie_read=function(t){var e,i,s=t+"=",n=document.cookie.split(";"),o=n.length;for(e=0;e<o;++e){for(i=n[e];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(s))return i.substring(s.length)}return s=t=n=e=i=o=null,null},cookie_erase=function(t){cookie_create(t,"",-1),t=null},Array.prototype.remove=function(t,e){var i=this.slice((e||t)+1||this.length);return this.length=t<0?this.length+t:t,this.push.apply(this,i)},AFRAME.registerComponent("glass-dispenser",{schema:{type:{type:"string",default:""}},init:function(){this.el.addEventListener("click",this.use.bind(this)),this.el.addEventListener("used-by",this.usedBy.bind(this))},use:function(t){if(!getInventory().heldObject){var e=getCupEntity(this.data.type);e.setAttribute("position",this.el.getAttribute("position")),document.querySelector("a-scene").appendChild(e),e.components.pickable.click(e.components.pickable)}},usedBy:function(t){var e=t.detail.user.el.components["drink-container"];e&&e.data.type==this.data.type&&e.scaleToNextSize()}}),AFRAME.registerComponent("leaderboard",{schema:{leaderboardId:{type:"number",default:-1}},onScoresRetrieved:function(t){if(null==t)return void console.log("Retrieving scores failed.");t.forEach(function(t){t.getPlayerName()==casdk.player.username&&(this.ownScore=t.getScore())}.bind(this));let e="\nTop earning coffee houses:\n\n";for(let n=0;n<Math.min(5,t.length);n++){var i=t[n].getPlayerName(),s=(t[n].getScore()/100).toFixed(2)+" $\n";e+=n+1+"\t"+i+new Array(8-Math.floor((i.length+s.length)/4)).join("\t")+s}this.el.setAttribute("text","value",e)},updateLeaderboard:function(){this.leaderboard.retrieve(1,32).then(this.onScoresRetrieved.bind(this))},init:function(){"casdk"in window&&(casdk.login("","","ca",!1).then(function(t){this.leaderboard=new casdk.Leaderboard(this.data.leaderboardId,t),this.leaderboard.retrieve(1,32).then(this.onScoresRetrieved.bind(this))}.bind(this)).catch(function(t){this.leaderboard=new casdk.Leaderboard(this.data.leaderboardId),this.leaderboard.retrieve(1,32).then(this.onScoresRetrieved.bind(this))}.bind(this)),this.ownScore=0)},submitScore:function(t){this.leaderboard.submit(Math.floor(this.ownScore+100*t)).then(this.updateLeaderboard.bind(this)).catch(function(t){console.log("Submit failed. Please log in to submit scores."),console.log(t)})}}),AFRAME.registerComponent("level-select-button",{init:function(){this.el.addEventListener("click",this.beginLevel.bind(this))},beginLevel:function(t){if(void 0==this.el.components.material||!this.el.components.material.data.transparent){var e=this.el.object3D.position;playSound("uiconfirm",e.x,e.y,e.z),this.el.parentNode.emit("hide"),startLevelTutorialCheck(parseInt(this.el.components.text.data.value))}},onHover:function(t){if(void 0==this.el.components.material||!this.el.components.material.data.transparent){this.el.setAttribute("scale","1.2 1.2 1.2");var e=this.el.object3D.position;playSound("uihover",e.x,e.y,e.z)}},offHover:function(t){this.el.setAttribute("scale","1.0 1.0 1.0")}}),AFRAME.registerComponent("main-menu",{init:function(){scene=document.querySelector("a-scene"),this.logo=document.createElement("a-image"),this.logo.setAttribute("position","0 2.67 -0.35"),this.logo.setAttribute("alpha-test",.5),this.logo.setAttribute("src","#logo"),this.logo.setAttribute("scale","1.5 1.5 1.5"),this.el.appendChild(this.logo),this.levels=spawnLevelSelectionMenu(-.8,2.04,.4,-.4),this.levels.setAttribute("position","0 1000 0"),this.levels.setAttribute("visible",!1),this.levels.addEventListener("showMenu",this.showMenu.bind(this)),this.levels.addEventListener("hide",this.hidePlay.bind(this)),this.options=spawnOptionsMenu(-.6,2,-.4),this.options.addEventListener("showMenu",this.showMenu.bind(this)),this.options.setAttribute("position","0 1000 0"),this.options.setAttribute("visible",!1),this.menu=spawnMainMenu(0,2.04,-.42),this.menu.addEventListener("showPlay",this.showPlay.bind(this)),this.menu.addEventListener("showOptions",this.showOptions.bind(this)),scene.addEventListener("loaded",function(){if(sceneLoaded=!0,"casdk"in window&&casdk.isLoggedIn()){var t=casdk.player.username;storeName=t+"'"+("s"==t.substr(-1)?"":"s")+" Coffee House",document.getElementById("storename").setAttribute("text",{value:storeName})}});var t=parseInt(cookie_read("unlockedLevel"),10);t&&(unlockedLevels=t),setUnlockedLevelsState(),mainMenuComponent=this},hidePlay:function(t){this.levels.setAttribute("position","0 1000 0"),this.levels.setAttribute("visible",!1),this.logo.setAttribute("visible",!1)},showPlay:function(t){this.levels.setAttribute("position","0 0 0"),this.levels.setAttribute("visible",!0),this.logo.setAttribute("visible",!0),this.hideMenu()},showOptions:function(t){this.options.setAttribute("position","0 0 0"),this.options.setAttribute("visible",!0),this.hideMenu()},hideOptions:function(t){this.options.setAttribute("position","0 1000 0"),this.options.setAttribute("visible",!1)},showMenu:function(t){this.levels.setAttribute("position","0 1000 0"),this.levels.setAttribute("visible",!1),this.options.setAttribute("position","0 1000 0"),this.options.setAttribute("visible",!1),this.menu.setAttribute("position","0 0 0"),this.menu.setAttribute("visible",!0)},hideMenu:function(t){this.menu.setAttribute("position","0 1000 0"),this.menu.setAttribute("visible",!1)}}),AFRAME.registerComponent("menu-button",{init:function(){this.el.addEventListener("click",this.click.bind(this)),this.el.setAttribute("scale-on-hover","")},click:function(t){if(this.el.components.text)switch(this.el.components.text.data.value){case"Play":this.el.parentNode.emit("showPlay");break;case"Options":this.el.parentNode.emit("showOptions");break;case"Exit":window.location="https://constructarca.de/construct-arcade/vr/";break;case"Reset\nprogress":unlockedLevels=1,setUnlockedLevelsState();break;case"Credits":mainMenuComponent.hideOptions(),creditsComponent.showCredits();break;case"Back":this.el.parentNode.emit("showMenu")}else window.location="https://constructarca.de/vr/";var e=this.el.object3D.position;playSound("uiconfirm",e.x,e.y,e.z)}}),AFRAME.registerComponent("milkfoamer",{init:function(){this.fillAmount=0,this.foamed=!1,this.el.addEventListener("fill",this.foam.bind(this)),this.el.addEventListener("used-by",this.fill.bind(this))},isFoamed:function(){return this.foamed},foam:function(){this.foamed=!0,this.el.setAttribute("pickable",{slotmask:slotMasks.milkFoamerFoamed+slotMasks.movingMarker})},fill:function(t){if(2!=this.fillAmount&&"milkcarton"==t.detail.user.el.getAttribute("id")){this.fillAmount=2,this.el.setAttribute("pickable",{slotmask:slotMasks.milkFoamer+slotMasks.movingMarker});var e=this.el.object3D.position;playSound("milk",e.x,e.y,e.z),this.el.querySelector("."+drinkLevelNames[1]).setAttribute("visible",!0)}},use:function(){if(0==this.fillAmount||!this.foamed)return!1;this.fillAmount--;var t=this.el.object3D.position;(playSound("milk",t.x,t.y,t.z),this.el.querySelector("."+drinkLevelNames[this.fillAmount]).setAttribute("visible",!1),1==this.fillAmount)?this.el.querySelector("."+drinkLevelNames[0]).setAttribute("visible",!0):0==this.fillAmount&&(this.el.setAttribute("pickable",{slotmask:slotMasks.movingMarker}),this.foamed=!1);return!0}}),AFRAME.registerComponent("money",{init:function(){moneyComponent=this,this.el.addEventListener("click",this.onClick.bind(this)),this.effectEl=document.querySelector("a-scene").querySelector("#moneyeffect")},beginAnimation:function(t){this.el.setAttribute("animation",{from:t}),this.el.emit("move"),this.onClick(!0),this.el.setAttribute("visible",!0),this.el.setAttribute("class","clickable")},onClick:function(t){this.el.getAttribute("visible")&&(this.el.setAttribute("visible",!1),this.el.setAttribute("class",""),playSound("cash",-.9332,1.1764,.4528),addScore(trayMoneyAmount),this.effectEl&&this.effectEl.emit("playEffect"))}}),AFRAME.registerComponent("next-levels-button",{schema:{levelParentId:{type:"string",default:""}},init:function(){this.el.addEventListener("click",this.showNextLevels.bind(this))},showNextLevels:function(){var t=document.querySelector("a-scene").querySelector("#"+this.data.levelParentId);if(t){for(var e=t.querySelectorAll("a-entity"),i=0;i<e.length;i++)"back"!=e[i].getAttribute("id")&&"nextlevels"!=e[i].getAttribute("id")&&e[i].setAttribute("text",{value:nextLevelsOnRight?i+11:i+1});nextLevelsOnRight=!nextLevelsOnRight,this.el.object3D.position.x=-1*this.el.object3D.position.x,this.el.setAttribute("text",{value:this.el.object3D.position.x>0?">":"<"}),setUnlockedLevelsState();var s=this.el.object3D.position;playSound("uiconfirm",s.x,s.y,s.z)}}});const startColor="#BB1A0F",targetColor="#7ABB5F";AFRAME.registerComponent("patience-bar",{schema:{maxscale:{type:"float",default:2880}},init:function(){this.scale=2880,this.running=!1,this.currentTime=0,this.length=40,this.el.addEventListener("activate",this.activate.bind(this)),this.el.addEventListener("deactivate",this.deactivate.bind(this)),this.childEl=this.el.querySelector("a-entity")},tick:function(t,e){if(this.running)return this.currentTime+=e/1e3,this.scale=this.data.maxscale-this.currentTime/this.length*this.data.maxscale,this.childEl.setAttribute("scale",this.scale+" 1 1"),this.childEl.setAttribute("material",{color:lerpColor("#BB1A0F","#7ABB5F",this.scale/this.data.maxscale)}),this.scale<=0?(this.el.setAttribute("visible",!1),this.running=!1,void this.el.emit("timerfinished",this.el,!1)):void 0},activate:function(t){this.el.setAttribute("visible",!0),this.length=t.detail.time*currentPatienceFactor,console.log("time:"+this.length),this.currentTime=0,this.scale=0,this.running=!0},deactivate:function(){this.el.setAttribute("visible",!1),this.running=!1}}),AFRAME.registerComponent("progress-bar",{schema:{timestep:{type:"float",default:.01},maxscale:{type:"float",default:2880},index:{type:"int",default:-1}},init:function(){this.scale=0,this.running=!1,this.currentTime=0,this.el.addEventListener("deactivate",this.deactivate.bind(this)),this.used=!1},tick:function(t,e){if(this.running)return this.currentTime+=e/1e3,this.scale=this.currentTime/this.length*this.data.maxscale,this.el.querySelector("a-entity").setAttribute("scale",this.scale+" 1 1"),this.scale>=this.data.maxscale?(this.el.emit("timerfinished",this.el,!1),void this.deactivate()):void 0},useIfUnused:function(){return!this.used&&(this.used=!0,!0)},setTimerFinishedListener:function(t){this.timerFinishedListener=t,this.el.addEventListener("timerfinished",t)},activate:function(t,e=10){this.el.setAttribute("visible",!0),this.el.setAttribute("position",t),this.length=e,this.currentTime=0,this.scale=0,this.running=!0},deactivate:function(){this.timerFinishedListener&&(this.el.removeEventListener("timerfinished",this.timerFinishedListener),this.timerFinishedListener=void 0),this.el.setAttribute("visible",!1),this.running=!1,this.used=!1}}),AFRAME.registerComponent("radio",{init:function(){var t=music.play();music.pos(-.003733,1.10959,2.78815,t);var e=!0;this.el.addEventListener("click",function(){music.mute(e=!e,t)})}}),AFRAME.registerComponent("recipe-manager",{schema:{difficulty:{type:"int",default:0}},init:function(){readRecipesFile(),readLevelsFile()}}),AFRAME.registerComponent("results",{dependencies:["text"],init:function(){this.el.addEventListener("click",this.hideResults.bind(this)),resultsWindow=this},showResults:function(t){this.el.setAttribute("visible",!0),this.el.setAttribute("class","clickable"),this.el.querySelector("a-entity").setAttribute("text",{value:t?"You won!":"Try Again!",color:t?"#66d321":"#ad2914"}),this.el.setAttribute("text",{value:getResultText(clockComponent.getRemainingTime())});for(var e=0,i=0;i<starScoresCurrentRound.length;i++)score>=starScoresCurrentRound[i]&&e++;starsComponent.setActiveStars(e);var s=roundDecimals(score,1).toFixed(2),n=s/roundDecimals(starScoresCurrentRound[0],1).toFixed(2),o=fulfilledOrdersCurrentRound+amountFailedOrdersCurrentRound;window.dispatchEvent(new CustomEvent("roundEnd",{detail:{level:currentLevel,stars:e,score:s,score_percentage:n,fulfilled_orders:fulfilledOrdersCurrentRound,failed_orders:amountFailedOrdersCurrentRound,total_orders:o}}))},hideResults:function(){this.el.setAttribute("visible",!1),this.el.setAttribute("class",""),starsComponent.resetStars(),mainMenuComponent.showPlay(!1)}}),AFRAME.registerComponent("scale-on-hover",{schema:{sound:{type:"string",default:""},factor:{type:"float",default:1.1}},init:function(){this.el.addEventListener("mouseenter",this.onHover.bind(this)),this.el.addEventListener("mouseleave",this.onHoverLeave.bind(this)),this.originalScale=this.el.object3D.scale.clone(),this.lockHover=!1},onHover:function(){if(!this.lockHover){if(this.lockHover=!0,""!=this.data.sound){var t=this.el.object3D.position;playSound(this.data.sound,t.x,t.y,t.z)}this.el.object3D.scale.multiplyScalar(this.data.factor)}},onHoverLeave:function(){this.el.object3D.scale.copy(this.originalScale),this.lockHover=!1}}),AFRAME.registerComponent("score",{dependencies:["text"],init:function(){score=0,this.el.setAttribute("text",{value:"$"+roundDecimals(score,1).toFixed(2)}),scoreComponent=this},increaseScore:function(t){score+=t,this.el.setAttribute("text",{value:"$"+roundDecimals(score,1).toFixed(2)})},resetScore:function(){score=0,this.el.setAttribute("text",{value:"$0.00"})}}),normalizeWeights=function(t){var e=0;for(key in t)e+=t[key];for(key in t)t[key]/=e},selfWeightedRandom=function(t,e){var i=Math.random(),s=0;for(key in t){if(i<=(s+=t[key]))return key}},AFRAME.registerComponent("set-origin-marker",{init:function(){this.el.addEventListener("pickup",this.setOriginMarker.bind(this)),this.el.addEventListener("placed",this.onDrop.bind(this))},setOriginMarker:function(){originMarker||(originMarker=document.querySelector("a-scene").querySelector("#origin-marker"));var t=this.el.components.pickable;t&&originMarker.setAttribute("position",t.originalPosition)},onDrop:function(t){t.detail.slot.el.getAttribute("id")==originMarker.getAttribute("id")&&t.detail.slot.clear()}});var sound=new Howl({sprite:{cash:[0,1804.9659863945578],cup:[3e3,187.1882086167802],espresso:[5e3,13226.689342403628],"filter-insert":[2e4,471.2471655328798],glass:[22e3,366.87074829931987],grinder:[24e3,5258.45804988662],"grumble-woman":[31e3,1071.0430839002286],grumble0:[34e3,717.5283446712015],grumble1:[36e3,486.3492063492032],grumble2:[38e3,715.2607709750569],"milk-steamer":[4e4,8438.730158730159],milk:[5e4,1556.757369614516],"mumble-woman":[53e3,582.3809523809516],mumble0:[55e3,1321.5873015873],mumble1:[58e3,981.0204081632676],mumble2:[6e4,1902.902494331066],"sirup-dispenser":[63e3,696.7800453514741],steps:[65e3,1976.0544217687084],trash:[68e3,812.2448979591894],uiconfirm:[7e4,48.185941043087155],uihover:[72e3,48.45804988661939]},src:["sounds/barista-express-sounds.mp3"]}),music=new Howl({src:["sounds/main.mp3"],loop:!0,volume:.1});AFRAME.registerComponent("stars",{init:function(){starsComponent=this,this.setActiveStars(0)},setActiveStars:function(t){this.resetStars();for(var e=this.el.querySelectorAll("a-gltf-model"),i=0;i<3;i++)e[i].setAttribute("visible",i<t),i<t&&e[i].emit("showStar")},resetStars:function(){for(var t=this.el.querySelectorAll("a-gltf-model"),e=0;e<3;e++)t[e].setAttribute("scale","0 0 0"),t[e].setAttribute("visible",!1)}}),AFRAME.registerComponent("tutorial",{dependencies:["text"],init:function(){tutorialComponent=this,this.el.addEventListener("click",this.hideTutorial.bind(this)),this.imageChild=this.el.querySelector("a-image")},showTutorial:function(t){this.el.setAttribute("visible",!0),this.el.setAttribute("class","clickable"),this.imageChild.setAttribute("src",t)},hideTutorial:function(){this.el.setAttribute("visible",!1),this.el.setAttribute("class",""),startLevel(currentLevel)}}),AFRAME.registerComponent("use-dispenser",{schema:{liquidtype:{type:"int",default:2}},init:function(){this.el.addEventListener("used-by",this.use.bind(this)),this.el.querySelector("a-entity[animation__press]").addEventListener("animationcomplete",this.dispenseLiquid.bind(this))},use:function(t){this.lastEl=t.detail.user.el,this.lastEl.components["drink-container"]&&this.el.querySelector("a-entity[animation__press]").emit("dispense")},dispenseLiquid:function(t){if("animation__depress"!=t.detail.name){var e=this.el.object3D.position;playSound("dispenser",e.x,e.y+.65,e.z),this.el.querySelector("a-entity[animation__depress]").emit("depress"),this.lastEl.emit("fill",{liquidtype:this.data.liquidtype})}}});var clickableClass="clickable",getInventory=function(){return this.inventory||(this.inventory=document.querySelector("a-scene").systems.inventory),this.inventory};AFRAME.registerSystem("inventory",{init:function(){document.querySelector("a-scene").addEventListener("click",this.click.bind(this)),this.heldObject=null,this.useReceiver=null,this.slot=null},click:function(t){t.target.tagName},clear:function(){this.heldObject&&(this.canUse()||this.canPlace()||(this.heldObject=null))},canUse:function(){return null!=this.heldObject&&this.heldObject.isUsable()&&null!=this.useReceiver},canPlace:function(){return null!=this.heldObject&&this.heldObject.isPlaceable()&&null!=this.slot&&this.slot.isEmpty()}}),AFRAME.registerComponent("pickable",{schema:{slotmask:{type:"int",default:1}},init:function(){this.el.addEventListener("click",this.click.bind(this)),void 0==this.originalPosition&&(this.originalPosition=this.el.object3D.getWorldPosition()),this.el.addEventListener("reset",this.reset.bind(this))},isPlaceable:function(){return this.el.hasAttribute("placeable")},isUsable:function(){return this.el.hasAttribute("usable")},isBeingHeld:function(){return getInventory().heldObject===this},click:function(t){if(!this.isBeingHeld()&&!getInventory().heldObject){this.slot&&this.slot.clear(),this.setClickable(!1),getInventory().heldObject=this;var e=new window.CustomEvent("pickup",{detail:{object:this}});this.el.dispatchEvent(e)}},tick:function(t,e){if(this.isBeingHeld()){var i=this.el.getAttribute("position"),s=new THREE.Vector3;document.querySelector("a-scene").querySelector("a-entity[inventory]").object3D.getWorldPosition(s);var n=new THREE.Vector3(0,0,0);this.el.setAttribute("position",i.lerp(s.sub(n),.2))}else if(this.isPlaceable()&&null!=this.slot){i=this.el.getAttribute("position");var o=new THREE.Vector3;this.slot.el.object3D.getWorldPosition(o),this.el.setAttribute("position",i.lerp(o,.2))}else{i=this.el.getAttribute("position");this.el.setAttribute("position",i.lerp(this.originalPosition,.2))}},reset:function(){this.slot&&this.slot.clear()},setClickable:function(t){clickableClass&&(this.el.setAttribute("class",t?clickableClass:""),this.el.emit("setClickable",{state:t}))}}),AFRAME.registerComponent("usable",{init:function(){this.el.addEventListener("use",this.use.bind(this))},use:function(t){var e=getInventory().useReceiver;if(null!=e){var i=new window.CustomEvent("use-on",{detail:{receiver:e}});this.el.dispatchEvent(i);var s=new window.CustomEvent("used-by",{detail:{user:this}});e.el.dispatchEvent(s),t.preventDefault()}}}),AFRAME.registerComponent("placeable",{}),AFRAME.registerComponent("placable",{tick:function(t,e){console.error("YOU MISSPELLED 'placeable'! Add an 'e'")}}),AFRAME.registerComponent("slot",{schema:{mask:{type:"int",default:1}},init:function(){this.enabled=!0,this.el.addEventListener("click",this.click.bind(this)),this.el.addEventListener("mouseenter",this.setSlot.bind(this)),this.el.addEventListener("mouseleave",this.unsetSlot.bind(this)),this.el.addEventListener("setEnabled",this.setEnabled.bind(this))},tick:function(t,e){var i=this.el.getAttribute("visible"),s=getInventory().heldObject,n=null!=s&&s.data&&this.enabled&&s.isPlaceable()&&this.isEmpty()&&0!=(s.data.slotmask&this.data.mask);i!=n&&(this.el.setAttribute("visible",n),this.setClickable(n))},isEmpty:function(){return null==this.content},clear:function(){if(this.content){this.content.slot=null;var t=new window.CustomEvent("cleared",{detail:{content:this.content}});this.el.dispatchEvent(t)}this.content=null},click:function(t){if(null==this.content&&this.el.getAttribute("visible")){var e=getInventory().heldObject;if(e&&e.el.getAttribute("placeable")){this.content=e,e.slot=this,getInventory().heldObject=null,t.preventDefault(),this.content.setClickable(!0);var i=new window.CustomEvent("placed",{detail:{slot:this}});this.content.el.dispatchEvent(i);var s=new window.CustomEvent("filled",{detail:{content:this.content}});this.el.dispatchEvent(s)}}},setEnabled:function(t){this.enabled=t.detail.b,console.log("slotenabled: "+this.enabled)},setSlot:function(t){getInventory().slot=this},unsetSlot:function(t){getInventory().slot==this&&(getInventory().slot=null)},setClickable:function(t){clickableClass&&(this.el.setAttribute("class",t?clickableClass:""),this.el.emit("setClickable",{state:t}))}}),AFRAME.registerComponent("use-receiver",{init:function(){this.el.addEventListener("mouseenter",this.setReceiver.bind(this)),this.el.addEventListener("mouseleave",this.unsetReceiver.bind(this)),this.el.addEventListener("click",this.click.bind(this))},click:function(t){getInventory().heldObject&&getInventory().canUse()&&this.el.emit("used-by",{user:getInventory().heldObject})},setReceiver:function(t){getInventory().useReceiver=this},unsetReceiver:function(t){getInventory().useReceiver==this&&(getInventory().useReceiver=null)}}),function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=t,i.c=e,i.p="",i(0)}([function(t,e){var i={},s={};AFRAME.registerComponent("gltf-part",{schema:{buffer:{default:!0},part:{type:"string"},src:{type:"asset"}},update:function(){var t=this.el,e=document.querySelector("a-scene");!this.data.part&&this.data.src||this.getModel(function(i){i&&(e.systems.material.registerMaterial(i.material),t.setObject3D("mesh",i),t.emit("model-loaded",{format:"gltf",model:i}))})},getModel:function(t){var e=this;if(!s[this.data.src])return i[this.data.src]?i[this.data.src].then(function(i){t(e.selectFromModel(i))}):void(i[this.data.src]=new Promise(function(n){(new THREE.GLTFLoader).load(e.data.src,function(o){var r=o.scene||o.scenes[0];s[e.data.src]=r,delete i[e.data.src],t(e.selectFromModel(r)),n(r)},function(){},function(t){var i=t&&t.message?t.message:"Failed to load glTF model";console.warn(i),this.el.emit("model-error",{format:"gltf",src:e.data.src})}.bind(e))}));t(this.selectFromModel(s[this.data.src]))},selectFromModel:function(t){var e;if(e=t.getObjectByName(this.data.part)){var i=e.getObjectByProperty("type","Mesh");if(i)return new THREE.Mesh(i.geometry,i.material);console.error("[gltf-part] `"+this.data.part+"` has no Mesh.")}else console.error("[gltf-part] `"+this.data.part+"` not found in model.")}})}]),function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};e.m=t,e.c=i,e.p="",e(0)}([function(t,e){var i=AFRAME.utils.debug,s=AFRAME.utils.coordinates,n=i("components:look-at:warn"),o=s.isCoordinates||s.isCoordinate;delete AFRAME.components["look-at"],AFRAME.registerComponent("look-at",{schema:{default:"",parse:function(t){return o(t)||"object"==typeof t?s.parse(t):t},stringify:function(t){return"object"==typeof t?s.stringify(t):t}},init:function(){this.target3D=null,this.vector=new THREE.Vector3},update:function(){var t,e=this,i=e.data,s=e.el.object3D;return!i||"object"==typeof i&&!Object.keys(i).length?e.remove():"object"==typeof i?s.lookAt(new THREE.Vector3(i.x,i.y,i.z)):(t=e.el.sceneEl.querySelector(i))?t.hasLoaded?e.beginTracking(t):t.addEventListener("loaded",function(){e.beginTracking(t)}):void n('"'+i+'" does not point to a valid entity to look-at')},tick:function(){var t=new THREE.Vector3;return function(e){var i=this.target3D,s=this.el.object3D,n=this.vector;i&&(s.parent.worldToLocal(i.getWorldPosition(t)),this.el.getObject3D("camera")?n.subVectors(s.position,t).add(s.position):n=t,s.lookAt(n))}}(),beginTracking:function(t){this.target3D=t.object3D}})}]);